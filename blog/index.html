<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venture X AI Insights - Anya Ganger</title>
    <link rel="stylesheet" href="../assets/styles.css">
    <link id="google-fonts" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400;1,500;1,600&display=swap" rel="stylesheet">
    <style>
        .headshot-image {
            filter: grayscale(100%);
            transition: filter 0.3s ease;
        }
        .headshot-image:hover {
            filter: grayscale(0%);
        }
        .luxury-shadow {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
        }
        .luxury-hover {
            transition: all 0.3s ease;
        }
        .luxury-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
    </style>
</head>
<body>
    <div class="min-h-screen">
        <section class="py-24 px-6">
            <div class="max-w-6xl mx-auto">
                <div class="text-center mb-20 fade-in" data-testid="blog-header">
                    <h1 class="text-5xl md:text-6xl font-light tracking-tight mb-6" data-testid="blog-title" id="blog-title">
                        Venture X AI Insights
                    </h1>
                    <p class="text-xl text-muted-foreground font-light max-w-2xl mx-auto" data-testid="blog-tagline" id="blog-tagline">
                        Exploring the intersection of artificial intelligence and venture capital through thoughtful analysis and industry insights.
                    </p>
                </div>
                
                <div id="posts-container">
                    <div class="text-center py-20" data-testid="empty-posts">
                        <p class="text-muted-foreground text-lg">Loading posts...</p>
                    </div>
                </div>

                <!-- Full Screen Article Modal -->
                <div id="article-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden overflow-auto">
                    <div class="min-h-screen py-12 px-6">
                        <div class="max-w-4xl mx-auto">
                            <button 
                                onclick="closeArticle()"
                                class="mb-8 text-white hover:text-gray-200 transition-colors flex items-center font-medium"
                            >
                                ← Back to blog
                            </button>
                            <article class="bg-card rounded-lg p-12 luxury-shadow">
                                <header class="mb-12 text-center">
                                    <div class="flex items-center justify-center space-x-4 text-sm text-muted-foreground mb-6">
                                        <span id="modal-category"></span>
                                        <span>•</span>
                                        <span id="modal-read-time"></span>
                                        <span>•</span>
                                        <span id="modal-date"></span>
                                    </div>
                                    <h1 class="text-4xl md:text-5xl font-light tracking-tight mb-6" id="modal-title"></h1>
                                    <p class="text-xl text-muted-foreground font-light max-w-2xl mx-auto" id="modal-excerpt"></p>
                                </header>
                                <div class="prose prose-lg max-w-none text-foreground" id="modal-content"></div>
                            </article>
                        </div>
                    </div>
                </div>

                <div class="bg-card rounded-lg p-8 luxury-shadow text-center" data-testid="author-sidebar">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full overflow-hidden">
                        <img 
                            src="../assets/anya-headshot.png"
                            alt="Anya Ganger" 
                            class="w-full h-full object-cover headshot-image"
                        >
                    </div>
                    <h3 class="text-lg font-medium mb-2" data-testid="author-name" id="sidebar-author-name">
                        Anya Ganger
                    </h3>
                    <p class="text-sm text-muted-foreground mb-4" data-testid="blog-tagline" id="sidebar-blog-tagline">
                        Exploring the intersection of AI and venture capital
                    </p>
                    <a 
                        href="#" 
                        target="_blank" 
                        rel="noopener noreferrer"
                        class="inline-flex items-center text-accent-foreground font-medium hover:text-foreground transition-colors text-sm hidden"
                        data-testid="author-linkedin"
                        id="sidebar-author-linkedin"
                    >
                        Connect on LinkedIn →
                    </a>
                </div>
            </div>
        </section>
    </div>

    <script>
        async function loadBlogData() {
            try {
                // Load settings from localStorage
                const defaultSettings = {
                    'blog_title': 'Venture X AI Insights',
                    'blog_tagline': 'Exploring the intersection of artificial intelligence and venture capital through thoughtful analysis and industry insights.',
                    'homepage_name': 'Anya Ganger',
                    'author_linkedin': ''
                };
                
                const settings = JSON.parse(localStorage.getItem('siteSettings') || JSON.stringify(defaultSettings));
                
                // Update content with settings
                if (settings.blog_title) {
                    document.getElementById('blog-title').textContent = settings.blog_title;
                }
                if (settings.blog_tagline) {
                    document.getElementById('blog-tagline').textContent = settings.blog_tagline;
                }
                if (settings.homepage_name) {
                    document.getElementById('sidebar-author-name').textContent = settings.homepage_name;
                }
                if (settings.blog_tagline) {
                    document.getElementById('sidebar-blog-tagline').textContent = settings.blog_tagline;
                }
                if (settings.author_linkedin && settings.author_linkedin.trim() !== '') {
                    const linkedinLink = document.getElementById('sidebar-author-linkedin');
                    if (linkedinLink) {
                        linkedinLink.href = settings.author_linkedin;
                        linkedinLink.classList.remove('hidden');
                    }
                }

                // Load posts from database API (syncs across all devices)
                let posts = [];
                try {
                    const response = await fetch('https://anya.ganger.com/api/simple-posts.php');
                    if (response.ok) {
                        posts = await response.json();
                        // Sort by date in reverse chronological order (newest first)
                        posts.sort((a, b) => {
                            const dateA = new Date(a.publishedAt || a.createdAt || '1970-01-01');
                            const dateB = new Date(b.publishedAt || b.createdAt || '1970-01-01');
                            return dateB - dateA;
                        });
                    } else {
                        throw new Error('Failed to fetch posts');
                    }
                } catch (error) {
                    console.log('Failed to load posts from database');
                    // No fallback content - show empty state
                    posts = [];
                }
                
                // Store posts globally for openPost function
                window.currentPosts = posts;
                
                const postsContainer = document.getElementById('posts-container');
                
                if (posts && posts.length > 0) {
                    postsContainer.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-20" data-testid="posts-grid">
                            ${posts.map(post => `
                                <article class="group cursor-pointer luxury-hover" data-testid="post-card-${post.id}" onclick="openPost('${post.id}')">
                                    <div class="bg-card rounded-lg overflow-hidden luxury-shadow">
                                        <div class="p-8">
                                            <div class="flex items-center space-x-4 text-sm text-muted-foreground mb-4" data-testid="post-meta-${post.id}">
                                                <span>${post.category}</span>
                                                <span>•</span>
                                                <span>${post.readTime} min read</span>
                                            </div>
                                            <h3 class="text-xl font-medium mb-4 group-hover:text-accent-foreground transition-colors" data-testid="post-title-${post.id}">
                                                ${post.title}
                                            </h3>
                                            <p class="text-muted-foreground mb-6 line-clamp-3" data-testid="post-excerpt-${post.id}">
                                                ${post.excerpt.replace(/\n/g, '<br>')}
                                            </p>
                                            <span class="text-sm font-medium text-accent-foreground">
                                                Read more →
                                            </span>
                                        </div>
                                    </div>
                                </article>
                            `).join('')}
                        </div>
                    `;
                } else {
                    postsContainer.innerHTML = `
                        <div class="text-center py-20" data-testid="empty-posts">
                            <p class="text-muted-foreground text-lg">No posts published yet.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.log('Using default content');
                document.getElementById('posts-container').innerHTML = `
                    <div class="text-center py-20" data-testid="empty-posts">
                        <p class="text-muted-foreground text-lg">No posts published yet.</p>
                    </div>
                `;
            }
        }

        async function openPost(postId) {
            try {
                // First try to get from the current posts array
                let post = window.currentPosts?.find(p => p.id === postId);
                
                // If not found, fetch from API
                if (!post) {
                    const response = await fetch('https://anya.ganger.com/api/simple-posts.php');
                    if (response.ok) {
                        const allPosts = await response.json();
                        post = allPosts.find(p => p.id === postId);
                    }
                }
                
                if (post) {
                    // Populate modal with post data
                    document.getElementById('modal-title').textContent = post.title;
                    document.getElementById('modal-excerpt').textContent = post.excerpt;
                    document.getElementById('modal-category').textContent = post.category;
                    document.getElementById('modal-read-time').textContent = post.readTime + ' min read';
                    
                    // Format date properly
                    const dateText = post.publishedAt 
                        ? new Date(post.publishedAt).toLocaleDateString()
                        : (post.createdAt ? new Date(post.createdAt).toLocaleDateString() : 'Recent');
                    document.getElementById('modal-date').textContent = dateText;
                    
                    // Convert markdown-like content to HTML
                    const content = post.content.replace(/\n/g, '<br><br>');
                    document.getElementById('modal-content').innerHTML = content;
                    
                    // Show modal
                    document.getElementById('article-modal').classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                }
            } catch (error) {
                console.error('Could not open post');
            }
        }
        
        function closeArticle() {
            document.getElementById('article-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.id === 'article-modal') {
                closeArticle();
            }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeArticle();
            }
        });

        loadBlogData();

        // Load custom fonts from settings
        (async function() {
            try {
                const response = await fetch('https://anya.ganger.com/api/settings.php');
                if (response.ok) {
                    const settings = await response.json();
                    const bodyFont = settings.font_body || 'Inter';
                    const headingFont = settings.font_heading || 'Playfair Display';

                    // Update Google Fonts link
                    const fontUrl = 'https://fonts.googleapis.com/css2?family=' +
                        bodyFont.replace(/ /g, '+') + ':wght@300;400;500;600;700&family=' +
                        headingFont.replace(/ /g, '+') + ':ital,wght@0,400;0,500;0,600;1,400;1,500;1,600&display=swap';
                    document.getElementById('google-fonts').href = fontUrl;

                    // Apply fonts via CSS variables
                    document.documentElement.style.setProperty('--font-body', "'" + bodyFont + "', sans-serif");
                    document.documentElement.style.setProperty('--font-heading', "'" + headingFont + "', serif");
                }
            } catch (error) {
                console.log('Using default fonts');
            }
        })();
    </script>
    <script src="../assets/tracking.js" async></script>
</body>
</html>